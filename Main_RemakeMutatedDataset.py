import MutantManager
import ConfigManager
import TestManager
import VariantComposer

from FileManager import get_project_dir, get_all_variant_dirs

if __name__ == "__main__":
    # ------ START CONFIG ------
    base_dir = "/home/hieuvd/spl_dataset_generation/InputPreparation/new_projects"
    project_name = "4wise-ExamDB-NOB3"
    num_of_seeding_bugs = 1
    case_limit = 10000
    bug_ids = None
    bug_tuples = [('BackOut.ExamDataBaseImpl.AOIS_3', 'BonusPoints.ExamDataBaseImpl.ROR_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AORS_3'), ('BackOut.ExamDataBaseImpl.AOIS_11', 'BonusPoints.ExamDataBaseImpl.AOIU_2', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AOIU_10'), ('BackOut.ExamDataBaseImpl.AOIS_11', 'BonusPoints.ExamDataBaseImpl.ROR_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AOIU_10'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPoints.ExamDataBaseImpl.AOIU_2', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AOIU_4'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPoints.ExamDataBaseImpl.ROR_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AOIU_4'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPoints.ExamDataBaseImpl.AOIU_2', 'BonusPointsStatistics.ExamDataBaseImpl.COD_2'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPoints.ExamDataBaseImpl.AOIU_2', 'BonusPointsStatistics.ExamDataBaseImpl.AODU_1'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPoints.ExamDataBaseImpl.AOIU_2', 'BonusPointsStatistics.ExamDataBaseImpl.AODU_2'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPoints.ExamDataBaseImpl.AOIU_2', 'BonusPointsStatistics.ExamDataBaseImpl.ODL_32'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPoints.ExamDataBaseImpl.ROR_1', 'BonusPointsStatistics.ExamDataBaseImpl.AODU_2'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPoints.ExamDataBaseImpl.ROR_1', 'BonusPointsStatistics.ExamDataBaseImpl.AORS_1'), ('BackOut.ExamDataBaseImpl.COI_1', 'BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AORS_1'), ('BackOut.ExamDataBaseImpl.COI_1', 'BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.ASRS_1'), ('BackOut.ExamDataBaseImpl.COI_1', 'BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AORS_5'), ('BackOut.ExamDataBaseImpl.AOIS_3', 'BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.ODL_41'), ('BackOut.ExamDataBaseImpl.AOIS_3', 'BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AORS_1'), ('BackOut.ExamDataBaseImpl.AOIS_3', 'BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.ASRS_1'), ('BackOut.ExamDataBaseImpl.AOIS_3', 'BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AORS_5'), ('BackOut.ExamDataBaseImpl.AOIS_11', 'BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AORS_1'), ('BackOut.ExamDataBaseImpl.AOIS_11', 'BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.ASRS_1'), ('BackOut.ExamDataBaseImpl.AOIS_11', 'BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AORS_5'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.ODL_41'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AORS_5'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsStatistics.ExamDataBaseImpl.COD_2'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsStatistics.ExamDataBaseImpl.AODU_1'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsStatistics.ExamDataBaseImpl.AODU_2'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsStatistics.ExamDataBaseImpl.ODL_32'), ('BackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AOIS_23', 'BonusPointsStatistics.ExamDataBaseImpl.AORS_5'), ('BackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AOIS_23', 'BonusPointsStatistics.ExamDataBaseImpl.AORS_3'), ('BackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AOIS_23', 'BonusPointsStatistics.ExamDataBaseImpl.AORS_1'), ('BackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.ODL_41', 'BonusPointsStatistics.ExamDataBaseImpl.AORS_5'), ('BackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.ODL_41', 'BonusPointsStatistics.ExamDataBaseImpl.AORS_3'), ('BackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.ODL_41', 'BonusPointsStatistics.ExamDataBaseImpl.ODL_32'), ('BackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.ODL_41', 'BonusPointsStatistics.ExamDataBaseImpl.AORS_1'), ('BackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AOIS_5', 'BonusPointsStatistics.ExamDataBaseImpl.AORS_5'), ('BackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AOIS_5', 'BonusPointsStatistics.ExamDataBaseImpl.AORS_3'), ('BackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AOIS_5', 'BonusPointsStatistics.ExamDataBaseImpl.AORS_1'), ('BackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AOIS_47', 'BonusPointsStatistics.ExamDataBaseImpl.AORS_5'), ('BackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AOIS_47', 'BonusPointsStatistics.ExamDataBaseImpl.AORS_3'), ('BackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AOIS_47', 'BonusPointsStatistics.ExamDataBaseImpl.AORS_1'), ('BackOut.ExamDataBaseImpl.AOIS_3', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AORS_3', 'BonusPointsStatistics.ExamDataBaseImpl.COD_3'), ('BackOut.ExamDataBaseImpl.AOIS_3', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AORS_3', 'BonusPointsStatistics.ExamDataBaseImpl.AOIU_11'), ('BackOut.ExamDataBaseImpl.AOIS_11', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AOIU_10', 'BonusPointsStatistics.ExamDataBaseImpl.AOIU_2'), ('BackOut.ExamDataBaseImpl.AOIS_11', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AOIU_10', 'BonusPointsStatistics.ExamDataBaseImpl.AOIU_7'), ('BackOut.ExamDataBaseImpl.AOIS_11', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AOIU_10', 'BonusPointsStatistics.ExamDataBaseImpl.AOIU_11'), ('BackOut.ExamDataBaseImpl.AOIS_11', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AOIU_10', 'BonusPointsStatistics.ExamDataBaseImpl.ASRS_1'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AOIS_23', 'BonusPointsStatistics.ExamDataBaseImpl.AODU_2'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AOIS_23', 'BonusPointsStatistics.ExamDataBaseImpl.AORS_1'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.ODL_41', 'BonusPointsStatistics.ExamDataBaseImpl.ODL_32'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.ODL_41', 'BonusPointsStatistics.ExamDataBaseImpl.AORS_1'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AOIS_5', 'BonusPointsStatistics.ExamDataBaseImpl.COD_2'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AOIS_5', 'BonusPointsStatistics.ExamDataBaseImpl.AORS_1'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AOIS_47', 'BonusPointsStatistics.ExamDataBaseImpl.AODU_1'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AOIS_47', 'BonusPointsStatistics.ExamDataBaseImpl.AORS_1'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AOIU_4', 'BonusPointsStatistics.ExamDataBaseImpl.AOIU_11'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AORS_5', 'BonusPointsStatistics.ExamDataBaseImpl.COD_2'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AORS_5', 'BonusPointsStatistics.ExamDataBaseImpl.AODU_1'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AORS_5', 'BonusPointsStatistics.ExamDataBaseImpl.AODU_2'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AORS_5', 'BonusPointsStatistics.ExamDataBaseImpl.ODL_32'), ('BackOut.ExamDataBaseImpl.AORS_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AORS_5', 'BonusPointsStatistics.ExamDataBaseImpl.AORS_1'), ('BonusPoints.ExamDataBaseImpl.AOIU_3', 'BonusPointsBackOut.ExamDataBaseImpl.AOIS_3', 'BonusPointsStatistics.ExamDataBaseImpl.AOIU_2'), ('BonusPoints.ExamDataBaseImpl.AOIU_3', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AODU_1', 'BonusPointsStatistics.ExamDataBaseImpl.AOIU_2'), ('BonusPoints.ExamDataBaseImpl.AOIU_3', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AODU_1', 'BonusPointsStatistics.ExamDataBaseImpl.COD_3'), ('BonusPoints.ExamDataBaseImpl.AOIU_3', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AODU_1', 'BonusPointsStatistics.ExamDataBaseImpl.COD_1'), ('BonusPoints.ExamDataBaseImpl.AOIU_3', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AODU_1', 'BonusPointsStatistics.ExamDataBaseImpl.ASRS_1'), ('BonusPoints.ExamDataBaseImpl.AOIU_3', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.COD_5', 'BonusPointsStatistics.ExamDataBaseImpl.COD_3'), ('BonusPoints.ExamDataBaseImpl.AOIU_3', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.COD_5', 'BonusPointsStatistics.ExamDataBaseImpl.COD_1'), ('BonusPoints.ExamDataBaseImpl.AOIU_3', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.COD_5', 'BonusPointsStatistics.ExamDataBaseImpl.ASRS_1'), ('BonusPoints.ExamDataBaseImpl.AOIU_3', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.COD_1', 'BonusPointsStatistics.ExamDataBaseImpl.COD_3'), ('BonusPoints.ExamDataBaseImpl.AOIU_3', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.COD_1', 'BonusPointsStatistics.ExamDataBaseImpl.COD_1'), ('BonusPoints.ExamDataBaseImpl.AOIU_3', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.COD_1', 'BonusPointsStatistics.ExamDataBaseImpl.ASRS_1'), ('BonusPoints.ExamDataBaseImpl.AOIU_3', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.COD_3', 'BonusPointsStatistics.ExamDataBaseImpl.COD_3'), ('BonusPoints.ExamDataBaseImpl.AOIU_3', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.COD_3', 'BonusPointsStatistics.ExamDataBaseImpl.COD_1'), ('BonusPoints.ExamDataBaseImpl.AOIU_3', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.COD_3', 'BonusPointsStatistics.ExamDataBaseImpl.ASRS_1'), ('BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.ODL_41', 'BonusPointsStatistics.ExamDataBaseImpl.AORS_3'), ('BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.ODL_41', 'BonusPointsStatistics.ExamDataBaseImpl.ODL_32'), ('BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AORS_1', 'BonusPointsStatistics.ExamDataBaseImpl.COD_2'), ('BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AORS_1', 'BonusPointsStatistics.ExamDataBaseImpl.AODU_1'), ('BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AORS_1', 'BonusPointsStatistics.ExamDataBaseImpl.AODU_2'), ('BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AORS_1', 'BonusPointsStatistics.ExamDataBaseImpl.ODL_32'), ('BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.ASRS_1', 'BonusPointsStatistics.ExamDataBaseImpl.COD_2'), ('BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.ASRS_1', 'BonusPointsStatistics.ExamDataBaseImpl.AODU_1'), ('BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.ASRS_1', 'BonusPointsStatistics.ExamDataBaseImpl.AODU_2'), ('BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.ASRS_1', 'BonusPointsStatistics.ExamDataBaseImpl.ODL_32'), ('BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AORS_5', 'BonusPointsStatistics.ExamDataBaseImpl.COD_2'), ('BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AORS_5', 'BonusPointsStatistics.ExamDataBaseImpl.AODU_1'), ('BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AORS_5', 'BonusPointsStatistics.ExamDataBaseImpl.AODU_2'), ('BonusPointsBackOut.ExamDataBaseImpl.AOIU_1', 'BonusPointsBackOutStatistics.ExamDataBaseImpl.AORS_5', 'BonusPointsStatistics.ExamDataBaseImpl.ODL_32')]

    # ------ END CONFIG ------

    project_dir = get_project_dir(project_name, base_dir)
    config_output_paths = ConfigManager.get_config_paths(project_dir, sort=True)
    variant_dirs = get_all_variant_dirs(project_dir, sort=True)
    # generate mutants and inject them to "optional" features
    if bug_ids:
        mutated_project_dirs = MutantManager.regenerate_filtered_mutants_from_bug_ids(project_dir, bug_ids,
                                                                                      num_of_bugs=num_of_seeding_bugs,
                                                                                      case_limit=case_limit)
    elif bug_tuples:
        mutated_project_dirs = MutantManager.regenerate_filtered_mutants_from_bug_tuples(project_dir, bug_tuples)
    else:
        raise Exception("Invalid bug input options")

    # compile mutated feature's source code
    for mutated_project_dir in mutated_project_dirs:
        for config_path, variant_dir in zip(config_output_paths, variant_dirs):
            mutated_variant_dir = VariantComposer.compose_by_config(mutated_project_dir, config_path)
            TestManager.link_generated_junit_test_cases(variant_dir, mutated_variant_dir)

        ConfigManager.copy_configs_report(project_dir, mutated_project_dir)
